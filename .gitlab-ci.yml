# Copyright (C) 2020, 2021, 2022  WofWca <wofwca@protonmail.com>

# This file is part of Jump Cutter Browser Extension.

# Jump Cutter Browser Extension is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# Jump Cutter Browser Extension is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.

# You should have received a copy of the GNU Affero General Public License
# along with Jump Cutter Browser Extension.  If not, see <https://www.gnu.org/licenses/>.


image: node
stages:
  - build
before_script:
  - yarn install
  - git submodule update --init
build chromium:
  stage: build
  script:
    # TODO chore: how about include reports? IDK how tho.
    # https://docs.gitlab.com/ee/ci/pipelines/job_artifacts.html#artifactsreports
    - yarn build:chromium --env noreport
  artifacts:
    # TODO chore: when https://gitlab.com/gitlab-org/gitlab-runner/-/issues/1057 is merged, specify `cwd: dist`
    # so Mozilla Add-ons Store accepts the archieve.
    paths:
      - dist/
    name: "$CI_JOB_NAME-$CI_COMMIT_REF_NAME"
  timeout: 10 minutes
build gecko:
  stage: build
  # TODO refactor: DRY with `build chromium`? YAML anchors?
  script:
    - yarn build:gecko --env noreport
  artifacts:
    paths:
      - dist/
    name: "$CI_JOB_NAME-$CI_COMMIT_REF_NAME"
  timeout: 10 minutes
